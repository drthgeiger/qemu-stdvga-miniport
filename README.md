# Windows NT video miniport driver for QEMU/std-vgaThis is a port of the virtualbox miniport driver for Windows NT provided by the [OS/2 Museum](https://www.os2museum.com/wp/) to QEMU.Most of the original code is unchanged and therefore attributed to Michal Necasek. I only had to apply some small changes to make it running on QEMU against its standard vga graphics adapter. If you want to read through the original publications or get the original driver/source code for use with virtualbox, visit [this link](https://www.os2museum.com/wp/nt-video-miniport-uhd/).This driver works with the standard vga adapter (std-vga) of QEMU and is able to provide high resolution video modes in all x86-based Windows NT versions from 3.5 up to Windows 7. The original driver for virtualbox also supported Windows NT 3.1 but I had to drop the support in this QEMU port. It is tested against QEMU 6 and 7 but is expected to also work on newer versions.The driver uses software rendering provided by Microsofts own implementation shipped as `framebuf.dll` with every Windows NT version. The framebuffer used by `framebuf.dll` is shared with the graphics adapter and no expensive conversions to VGA modes are necessary. Therefore it is expected to be faster than the default vga drivers.# Known issuesThe following issues were observed with this port. I don't know if they are also present in the original virtualbox driver.* Windows NT4 SP6: Maximum amount of supported video ram is 32MB. Interestingly this issue is not present when using only SP1. Other SPs were not tested.# InstallationTo install this driver the display property dialog should be used. There are two versions of the INF file: `oemsetup.inf` for Windows NT 3.x and `vidmini.inf` for Windows NT 4 and later versions.**IMPORTANT:** For Windows NT 3.x, the `framebuf.dll` library provided on the NT installation media is required and should be copied to the directory containing the driver files. It is sufficient to copy the compressed file `framebuf.dl_` provieded in `\I386` on the installation media. For Windows NT 4.0 and later, `framebuf.dll` is already preinstalled on the system.# Implementation overviewThe source code is split into two parts: The _boxv_ module (`boxv\*`) and the _miniport_ module (`videomp*`). The _boxv_ module provides a simple collection of routines to set arbitrary 8/16/24/32bpp modes on the QEMU standard vga graphics adapter which in fact also provides an implementation of the bochs graphics adapter (BGA) just as the virtualbox VGA adapter is based on the BGA. The _vidmini_ module implements the Windows NT video miniport interface.The miniport only provides minimal mode setting and palette access interface since the virtual hardware does not support hardware cursors etc. All drawing is left to `framebuf.dll`, the default Windows NT framebuffer display driver.Please refer to the Windows NT DDK for documentation on the video miniport interface.# BuildingThe miniport is designed to be built with Open Watcom C/C++ 1.9 or later (just use `wmake` in the build environment). Windows has been tested as a build host, but it is likely that other host platforms can be used with minor changes.# LicensingThe source code is published under the MIT license just as the original source code is.